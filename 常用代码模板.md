# 常用代码模板

# 1 ubuntu串口通讯

```c++
#include <boost/asio.hpp>               
#include <boost/bind.hpp>
using namespace boost::asio;
unsigned char buf1[10];
io_service iosev;
serial_port sp(iosev, "/dev/ttyUSB0");
unsigned char buf[7]={'w','t','r',50,50,50,0x00};
int main(int argc, char *argv[]) {
    sp.set_option(serial_port::baud_rate(9600));
    sp.set_option(serial_port::flow_control());
    sp.set_option(serial_port::parity());
    sp.set_option(serial_port::stop_bits());
    sp.set_option(serial_port::character_size(8));
    read(sp, buffer(buf1)); 
    write(sp, buffer(buf,7))
    return 0;
}
```

> 注意：串口未开启时会抛出异常

# 2 ros安装

```bash
sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu `lsb_release -sc` main" > /etc/apt/sources.list.d/ros-latest.list'
wget http://packages.ros.org/ros.key -O - | sudo apt-key add -
sudo apt-get update
sudo apt-get install ros-kinetic-desktop-full ros-kinetic-joy ros-kinetic-octomap-ros ros-kinetic-mavlink python-wstool python-catkin-tools protobuf-compiler libgoogle-glog-dev ros-kinetic-control-toolbox
sudo rosdep init
rosdep update
source /opt/ros/kinetic/setup.bash
```

# 3 CMakeList

```cmake
cmake_minimum_required(VERSION 2.8.3)
project(dip)

set(OpenCV_DIR /opt/ros/kinetic/share/OpenCV-3.3.1-dev)

find_package(catkin REQUIRED COMPONENTS
        OpenCV REQUIRED
        roscpp
        rospy
        std_msgs
        )

catkin_package(
)

include_directories(
include ${catkin_INCLUDE_DIRS}
${catkin_INCLUDE_DIRS}
)


add_executable(fss
src/fss.cpp )#include/myHist.h src/myHist.cpp)
add_dependencies(fss ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})
target_link_libraries(fss
${catkin_LIBRARIES}
${OpenCV_LIBRARIES} )
```

# 4 OpenCV

```cpp
#include "opencv2/opencv.hpp"
using namespace cv;
int main(int argc, char **argv)
{
    VideoCapture capture;
    capture.open(0);
    Mat frame;
    while(capture.isOpened())
    {
        capture.read(frame);
        imshow("origin",frame);
        if(waitKey(1)=='q')
            break;
    }
    return 0;
}
```



# 5 ROS

```cpp

#include "ros/ros.h"
#include "std_msgs/String.h"
#include <sstream>

int main(int argc, char **argv)
{
  ros::init(argc, argv, "talker");
  ros::NodeHandle n;
  ros::Publisher chatter_pub = n.advertise<std_msgs::String>("chatter", 1000);
  ros::Rate loop_rate(10);
  while (ros::ok())
  {
    std_msgs::String msg;
    std::stringstream ss;
    ss << "hello world " << count;
    msg.data = ss.str();
    ROS_INFO("%s", msg.data.c_str());
    chatter_pub.publish(msg);
    ros::spinOnce();
    loop_rate.sleep();
  }
  return 0;
}
```

```cpp
#include "ros/ros.h"
#include "std_msgs/String.h"

void chatterCallback(const std_msgs::String::ConstPtr& msg)
{
  ROS_INFO("I heard: [%s]", msg->data.c_str());
}
int main(int argc, char **argv)
{

  ros::init(argc, argv, "listener");
  ros::NodeHandle n;
  ros::Subscriber sub = n.subscribe("chatter", 1000, chatterCallback);
  ros::spin();
  return 0;
}
```

```python
#!/usr/bin/env python
# license removed for brevity
import rospy
from std_msgs.msg import String

def talker():
pub = rospy.Publisher('chatter', String, queue_size=10)
rospy.init_node('talker', anonymous=True)
rate = rospy.Rate(10) # 10hz
while not rospy.is_shutdown():
hello_str = "hello world %s" % rospy.get_time()
rospy.loginfo(hello_str)
pub.publish(hello_str)
rate.sleep()

if __name__ == '__main__':
	try:
		talker()
	except rospy.ROSInterruptException:
		pass
```

```python
#!/usr/bin/env python
import rospy
from std_msgs.msg import String

def callback(data):
    rospy.loginfo(rospy.get_caller_id() + "I heard %s", data.data)
    
def listener():
    rospy.init_node('listener', anonymous=True)
    rospy.Subscriber("chatter", String, callback)
    rospy.spin()

if __name__ == '__main__':
    listener()
```

